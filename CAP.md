![](https://img-blog.csdnimg.cn/img_convert/de1847339ed98b5081e2ef1bd1b5cd4b.png)

## **CP 架构**
CP架构即 Consisteny（一致性）与 Partition tolerance（分区容错性）的组合。
![](https://img-blog.csdnimg.cn/img_convert/d3e4971e142aaac388aa584b24b702a5.png)
如上图，由于网络问题，节点A和节点B之前不能互相通讯。当有客户端（上图Actor）向节点A进行写入请求时（准备写入Message 2），节点A会不接收写入操作，导致写入失败，这样就保证了节点A和节点B的数据一致性，即保证了Consisteny（一致性）。
然后，如果有另一个客户端（上图另一个Actor）向B节点进行读请求的时候，B请求返回的是网络故障之前所保存的信息（Message 1），并且这个信息是与节点A一致的，是整个系统最后一次成功写入的信息，是能正常提供服务的，即保证了Partition tolerance（分区容错性）。
上述情况就是保障了CP架构，但放弃了Availability（可用性）的方案。

## **AP 架构**
AP架构即 Availability（可用性）与 Partition tolerance（分区容错性）的组合架构。

![](https://img-blog.csdnimg.cn/img_convert/140a3dba638507db149b7c0980b328dd.png)

如上图，由于网络问题，节点A和节点B之前不能互相通讯。当有客户端（上图Actor）向节点A进行写入请求时（准备写入Message 2），节点A允许写入，请求操作成功。但此时，由于A和B节点之前无法通讯，所以B节点的数据还是旧的（Message 1）。手机游戏当有客户端向B节点发起读请求时候，读到的数据是旧数据，与在A节点读到的数据不一致。但由于系统能照常提供服务，所以满足了Availability（可用性）要求。
因此，这种情况下，就是保障了AP架构，但其放弃了 Consisteny（一致性）。

## **CAP 注意事项**

了解了CAP定理后，对于开发者而言，当我们构建服务的时候，就需要根据业务特性作出权衡考虑，哪些点是当前系统可以取舍的，哪些是应该重点保障的。
即使是在同一个系统中，不同模块的数据可能应用的CAP架构都是不同的。举个例子，在某个电商系统中，属于用户模块的数据（账密、钱包余额等）对一致性的要求很高，就可以采用CP架构。而对于一些商品信息方面的数据对一致性要求没那么高，但为了照顾用户体验，所以对可用性要求更高一些，那么这个模块的数据就可以采用AP架构。
另外，虽然上面第二节讲到过我们只能选择CP和AP，无法选择CA。但这句话成立的前提条件是在系统发生了网络故障的情况下。然而，网络故障的概率在系统的整个生命周期中占比是很小的，因此我们在设计的时候，虽然要考虑网络问题下的方案，但也要考虑网络正常情况下的方案，即在网络正常情况下，CA是可以实现的，我们也需要去保证在绝大多数时间下的CA架构。
再者，即使我们按照CAP定理，三个中只能取其二，但不代表我们只需要保障其中的两点，而完全的放弃第三点，我们应该为不能保障的第三点也做一些防备措施或者冗余方案，来使系统更加的完善健全。



CP架构下，如果发生了分区现象，当节点间的数据不一致时，复制通道中断，那么系统接收到请求后为了满足一致性只能返回Error

而在AP架构下，如果同样的复制通道中断，为了可用，分区的节点只能返回旧的数据，那么这里就不满足一致性了。


ACID

是数据库管理系统为了保证事务的正确性而提出来的一个理论，包含4个约束

Atomicity，原子性
Consistency，一致性
Isolation，隔离性
Durability，持久性
ACID中的C是指数据库的数据完整性， CAP中的C是指分布式节点中的数据一致性



BASE

核心思想是即使无法做到强一致性（ CAP 的一致性就是强一致性），但应用可以采用适合的方式达到最终一致性（ Eventual Consistency ） 。

基本可用（Basically Available）
分布式系统在出现故障时，允许损失部分可用性，即保证核心可用。

软状态（Soft State）
允许系统存在中间状态，而该中间状态不会影响系统整体可用性。这里的中间状态就是CAP

理论中的数据不一致。

最终一致性（Eventual Consistency）
系统中的所有数据副本经过一定时间后，最终能够达到一致的状态。



BASE 理论本质上是对CAP 的延伸和补充，更具体地说，是对CAP 中AP 方案的一个补充。

CAP和BASE 相关的两点：

CAP 理论是忽略延时的，而实际应用中延时是无法避免的。
AP 方案中牺牲一致性只是指分区期间，而不是永远放弃一致性。


因此，ACID 是数据库事务完整性的理论， CAP 是分布式系统设计理论， BASE是CAP 理论中AP 方案的延伸。
